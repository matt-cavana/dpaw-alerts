@model IEnumerable<dpaw_alerts.Models.Contact>

@{
    ViewBag.Title = "Index";
}
<div id="breadcrumb">
    <ul class="breadcrumb">
        <li><i class="fa fa-home"></i><a href="~/Home"> Home</a></li>
        
        <li class="active">Contacts</li>
    </ul>
</div><!-- /breadcrumb-->
<div class="main-header clearfix">
    <div class="page-title">
        <h3 class="no-margin">Contacts</h3>
        <span>Department of Parks and Wildlife contacts list</span>
    </div><!-- /page-title -->

</div><!-- /main-header -->
<div class="row padding-md">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3>   &nbsp;  @Html.ActionLink("Create Contact", "Create", null, new { @class = "btn btn-sm btn-info pull-right" })</h3>

        </div>

        <div class="panel-body">
            @if (TempData["Message"] != null)
            {
                <div class="alert alert-success" id="msg">
                    <i class="glyphicon glyphicon-info-sign"></i>   @TempData["Message"]
                </div>
            }

            <div id="msg"> </div>
            <table class="table table-striped table-hover" id="dataTable">
                <thead>
                    <tr>
                        <th>##</th>
                        <th>
                            @Html.DisplayNameFor(model => model.OfficeName)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Email)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Phone)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Address)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.OfficeHours)
                        </th>
                        <th>
                           Author
                        </th>
                        
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @{int rowNo = 0;}
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@(rowNo+=1)</td>
                            <td>
                                @Html.DisplayFor(modelItem => item.OfficeName)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Email)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Phone)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Address)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.OfficeHours)
                            </td>
                            <td width="200">
                              <i class="fa fa-user purple"></i>
                                @Html.DisplayFor(modelItem => item.CreatedBy)
                                <i class="fa fa-calendar-check-o green"></i>     @Html.DisplayFor(modelItem => item.CreateDate) <br />
                                <i class="fa fa-user blue"></i>
                                        @Html.DisplayFor(modelItem => item.UpdatedBy)
                                            <i class="fa fa-calendar-check-o"></i>     @Html.DisplayFor(modelItem => item.LastUpdate)
                            </td>
                           
                            <td width="165">
                                <div class="btn-group-xs">
                                    @Html.ActionLink("Edit", "Edit", new { id = item.ContactId }, new { @class = "btn btn-sm btn-success" })
                                    @Html.ActionLink("Details", "Details", new { id = item.ContactId }, new { @class = "btn btn-sm btn-primary" })

                                    <input type="button" value="Delete" class="btn btn-danger delete" data-value="@item.ContactId" />
                                </div>
                               
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<script type="text/javascript">

    $(function () {

        $(".delete").click(function (e) {

            if (confirm('Are you sure want to delete?')) {
                e.preventDefault();
                var parent = $(this).parent().parent().parent();

                {

                    $.ajax({
                        url: '@Url.Action("AjaxDelete", "Contacts")',
                        type: 'POST',
                        dataType: 'json',
                        async: true,
                        data: { 'Id': $(this).attr('data-value') },
                        contentType: 'application/x-www-form-urlencoded',
                        beforeSend: function () {
                            parent.animate({ 'backgroundColor': '#fb6c6c' }, 300);
                        },
                        success: function (data) {
                            if (data.success) {

                                $("#msg").html("<div class='alert alert-success'>The contact has been deleted from the system! </div>");

                                parent.slideUp(300, function () {
                                    parent.remove();
                                });

                            }
                            else {
                                // show a message in a alert or div
                                $("#msg").html("<div class='alert alert-danger'>Sorry, the contact cannot be deleted! </div>");
                            }
                        }
                    });
                }
            }
            else return false;
        });

        //set the data table
        $('#dataTable').dataTable({
            "bJQueryUI": true,
            "sPaginationType": "full_numbers",
            // "bSort" : false,
            "aaSorting": [[1, "asc"]],
            "aoColumnDefs": [
                            { "bSortable": false, "aTargets": [7] }
            ]
        });
    });
</script>